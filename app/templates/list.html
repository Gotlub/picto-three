{% extends "base.html" %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/list.css') }}">
{% endblock %}


{% block content %}
<div class="container-fluid vh-100 d-flex flex-column">
    <!-- Top panels row -->
    <div class="row" style="height: 70%;">
        <!-- Left Sidebar: Load/Save Menu -->
        <div class="col-md-3 sidebar d-flex flex-column h-100">
            <!-- Tree Source Section -->
            <h4>{{ _('Tree Source') }}</h4>
            <div class="d-grid gap-2">
                <button id="import-tree-json-btn" class="btn btn-info">{{ _('Import Tree from JSON') }}</button>
            </div>
            <div class="load-tree-form d-flex flex-column mt-2">
                <h5 class="mt-2">{{ _('Load Tree from Database') }}</h5>
                <input type="text" id="tree-search" class="form-control mb-2" placeholder="{{ _('Search trees...') }}">
                <div id="tree-container" style="overflow-y: auto; max-height: 150px;">
                    <!-- Trees will be loaded here -->
                </div>
                <button id="load-tree-btn" class="btn btn-success w-100 mt-2">{{ _('Load Selected Tree') }}</button>
            </div>

            <hr class="my-4">

            <!-- List Operations Section -->
            <h4>{{ _('List Operations') }}</h4>
            <div class="d-grid gap-2">
                <button id="import-list-json-btn" class="btn btn-secondary">{{ _('Import List from JSON') }}</button>
                <button id="export-list-json-btn" class="btn btn-secondary">{{ _('Export List to JSON') }}</button>
            </div>

            {% if current_user.is_authenticated %}
            <div class="save-list-form mt-3">
                <h5 class="mt-2">{{ _('Save List') }}</h5>
                <div class="form-group mb-2">
                    <label for="list-name">{{ _('List Name') }}</label>
                    <input type="text" id="list-name" class="form-control" placeholder="{{ _('Enter list name') }}">
                </div>
                <div class="form-check mb-2">
                    <input type="checkbox" id="list-is-public" class="form-check-input">
                    <label class="form-check-label" for="list-is-public">{{ _('Make Public') }}</label>
                </div>
                <button id="save-list-btn" class="btn btn-primary w-100">{{ _('Save List') }}</button>
            </div>
            {% endif %}

            <div class="load-list-form flex-grow-1 d-flex flex-column mt-3">
                <h5 class="mt-2">{{ _('Load List from Database') }}</h5>
                <input type="text" id="list-search" class="form-control mb-2" placeholder="{{ _('Search lists...') }}">
                <div id="list-container" class="flex-grow-1" style="overflow-y: auto;">
                    <!-- Lists will be loaded here -->
                </div>
                <button id="load-list-btn" class="btn btn-success w-100 mt-2">{{ _('Load Selected List') }}</button>
            </div>
        </div>

        <!-- Center Panel: Tree Visualization (Read-only) -->
        <div class="col-md-5 d-flex flex-column h-100">
             <div class="d-flex justify-content-between align-items-center">
                <h4>{{ _('Select from Tree') }}</h4>
                <small class="text-muted">{{ _('Drag to copy to list') }}</small>
            </div>
            <div class="tree-display border p-3 rounded flex-grow-1" id="tree-display" style="overflow: auto;">
                <!-- Tree will be built here -->
            </div>
             <div class="form-group mt-2">
                <label for="node-description-display">{{ _('Selected Node Description') }}</label>
                <textarea id="node-description-display" class="form-control" rows="2" readonly></textarea>
            </div>
        </div>

        <!-- Right Sidebar: Image Browser -->
        <div class="col-md-4 sidebar d-flex flex-column h-100">
            <div class="d-flex justify-content-between align-items-center">
                <h4>{{ _('Select from Images') }}</h4>
                 <small class="text-muted">{{ _('Drag to copy to list') }}</small>
            </div>
            <input type="text" id="image-search" class="form-control mb-2" placeholder="{{ _('Search images...') }}">
            <div class="image-sidebar border p-3 flex-grow-1" id="image-sidebar-tree" style="overflow: auto;">
                <!-- The dynamic image tree will be built here -->
            </div>
             <div class="form-group mt-2">
                <label for="image-description-display">{{ _('Selected Image Description') }}</label>
                <textarea id="image-description-display" class="form-control" rows="2" readonly></textarea>
            </div>
        </div>
    </div>

    <!-- Bottom panel row -->
    <div class="row mt-2" style="height: 30%;">
        <div class="col-12 d-flex flex-column h-100">
             <div class="d-flex justify-content-between align-items-center mb-2">
                <h4>{{ _('Chained List Builder') }}</h4>
                <div>
                    <button id="delete-link-btn" class="btn btn-danger">{{ _('Delete Selected Link') }}</button>
                    <button id="new-chain-btn" class="btn btn-secondary">{{ _('New Chain') }}</button>
                </div>
            </div>
            <div class="chained-list-container border p-3 rounded flex-grow-1" id="chained-list-container" style="overflow-y: auto;">
                <!-- Chained list items will be built here -->
            </div>
        </div>
    </div>
</div>

<script id="initial-tree-data" type="application/json">
    {{ initial_tree_data_json | safe }}
</script>
<script id="images-data" type="application/json">
    {{ all_images_json | safe }}
</script>

<script src="{{ url_for('static', filename='js/list.js') }}"></script>
{% endblock %}
