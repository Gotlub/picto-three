{% extends "base.html" %}

{% block content %}
<div class="container-fluid h-100 d-flex flex-column">
    <div class="row" style="flex: 1; min-height: 0;">
        <!-- Left Sidebar -->
        <div class="col-md-2 sidebar d-flex flex-column h-100">
            <!-- File Operations Section -->
            <h4>{{ _('File Operations') }}</h4>
            <div class="d-grid gap-2">
                <button id="import-json-btn" class="btn btn-secondary">{{ _('Import from JSON') }}</button>
                <button id="export-json-btn" class="btn btn-secondary">{{ _('Export to JSON') }}</button>
            </div>
            <hr>

            <!-- Database Operations Section -->
            <div class="flex-grow-1" style="overflow-y: auto;">
                {% if current_user.is_authenticated %}
                    <h4>{{ _('Database Operations') }}</h4>
                    <div class="save-tree-form">
                        <h5>{{ _('Save Tree') }}</h5>
                        <div class="form-group mb-2">
                            <label for="tree-name">{{ _('Tree Name') }}</label>
                            <input type="text" id="tree-name" class="form-control" placeholder="{{ _('Enter tree name') }}">
                        </div>
                        <div class="form-check mb-2">
                            <input type="checkbox" id="tree-is-public" class="form-check-input">
                            <label class="form-check-label" for="tree-is-public">{{ _('Make Public') }}</label>
                        </div>
                        <button id="save-tree-btn" class="btn btn-primary w-100">{{ _('Save Tree') }}</button>
                    </div>
                    <hr>
                {% endif %}
                <div class="load-tree-form">
                    <h5>{{ _('Load Tree from database') }}</h5>
                    <input type="text" id="tree-search" class="form-control mb-2" placeholder="{{ _('Search trees...') }}">
                    <div id="tree-list" class="mb-2" style="max-height: 200px; overflow-y: auto;"></div>
                    <button id="load-tree-btn" class="btn btn-success w-100">{{ _('Load Tree') }}</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-7 d-flex flex-column h-100">
            <div class="d-flex align-items-center mb-2">
                <h2 class="mb-0">{{ _('Tree Builder') }}</h2>
            </div>
            <div class="tree-display border p-3 rounded flex-grow-1" id="tree-display" style="overflow-y: auto;">
                <!-- Tree will be built here -->
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="col-md-3 sidebar d-flex flex-column h-100">
            <!-- Description Section -->
            <h4>{{ _('Node Description') }}</h4>
            <div class="form-group mb-2">
                <textarea id="node-description" class="form-control" rows="3" placeholder="{{ _('Enter node description...') }}"></textarea>
            </div>
            <hr>

            <!-- Images Section -->
            <h4>{{ _('Images') }}</h4>
            <input type="text" id="image-search" class="form-control mb-2" placeholder="{{ _('Search images...') }}">
            <div class="image-sidebar border p-3 flex-grow-1" id="image-sidebar-tree" style="overflow-y: auto;">
                <!-- The dynamic image tree will be built here -->
            </div>
            <hr>
            <div class="d-grid gap-2 mt-2">
                <button id="delete-btn" class="btn btn-danger">{{ _('Delete selected branch') }}</button>
                <button id="new-tree-btn" class="btn btn-secondary">{{ _('New tree') }}</button>
            </div>
        </div>
    </div>
</div>

<script id="initial-tree-data" type="application/json">
    {{ initial_tree_data_json | safe }}
</script>
<script id="images-data" type="application/json">
    {{ images_json | safe }}
</script>
<script src="{{ url_for('static', filename='js/builder.js') }}"></script>
{% endblock %}
